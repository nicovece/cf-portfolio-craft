{% import '_macros' as macros %}
{% set galleryItems = entry.gallery.eagerly().all() %}
{% if galleryItems|length %}
	<section
		class="grid grid-cols-[1fr_1fr] gap-8 bg-dark p-8 text-white max-sm:mx-auto md:gap-12 md:p-12 lg:grid-cols-[1fr_1fr_1fr_1fr] lg:gap-16 lg:p-16"
	>
		{% for item in galleryItems %}
			{% set image = item.image.one() %}
			{% if image %}
				<figure class="project-gallery-item {{ item.cssClasses ? '' ~ item.cssClasses ~ '' : '' }}">
					{% if item.hasModal %}
						{# Clickable image that opens modal #}
						{% set modalImg = item.modalImage.one() ? : image %}
						{% set modalCap = item.modalCaption ? : item.caption %}
						<button
							type="button"
							class="gallery__trigger flex w-full cursor-pointer items-start border-0 bg-transparent p-0"
							data-modal-image="{{ modalImg.getUrl('w2400') }}"
							data-modal-alt="{{ item.altText }}"
							data-modal-caption="{{ (modalCap ? : item.altText)|e('html_attr') }}"
							data-modal-entry-title="{{ entry.title }}"
							aria-label="Open larger view of {{ item.altText }}"
						>
							<img
								src="{{ image.getUrl('w1200') }}"
								srcset="{{ macros.srcSet(image) }}"
								sizes="(min-width: 700px) 50vw, 100vw"
								alt="{{ item.altText }}"
								loading="lazy"
							/>
						</button>
					{% else %}
						{# Regular non-clickable image #}
						<img
							src="{{ image.getUrl('w1200') }}"
							srcset="{{ macros.srcSet(image) }}"
							sizes="(min-width: 700px) 50vw, 100vw"
							alt="{{ item.altText }}"
							loading="lazy"
						/>
					{% endif %}
					<figcaption class="mt-2 text-sm text-gray-500">
						{{ item.caption ? : item.altText }}
					</figcaption>
				</figure>
			{% endif %}
		{% endfor %}
	</section>

	{# Modal markup - only if at least one item has modal enabled #}
	{% if galleryItems|filter(item => item.hasModal)|length %}
		<dialog
			id="gallery-modal"
			class="gallery__modal fixed inset-0 z-50 m-0 h-full max-h-full w-full max-w-full border-0 bg-transparent p-0 backdrop:bg-darker/85 backdrop:backdrop-blur-sm"
		>
			<div
				class="gallery__modal__content pointer-events-none flex w-full flex-col items-center justify-center pb-24 *:pointer-events-auto"
			>
				<button
					type="button"
					class="gallery__modal__close link-inline fixed top-0 right-4 z-10 min-h-8 min-w-8 cursor-pointer text-white hover:text-accent max-sm:border-none md:top-6 md:right-6"
					aria-label="Close modal"
				>
					âœ• <span class="sr-only md:not-sr-only">Close</span>
				</button>
				<p
					id="gallery-modal-caption"
					class="gallery__modal__caption sticky top-0 mb-24 block w-full bg-darker/85 py-8 text-center text-white backdrop-blur-sm"
				></p>
				<figure class="w-8/10 xl:w-1/2">
					{# <figcaption class="my-4 text-sm text-gray-500">
								<p id="gallery-modal-caption" class="mt-4 text-center text-white inline-block"></p>
							</figcaption> #}
					<img id="gallery-modal-image" src="" srcset="" sizes="60vw" alt="" class="w-full" loading="eager" />
				</figure>
			</div>
		</dialog>
	{% endif %}
{% endif %}
