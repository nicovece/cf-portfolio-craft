{% extends '_layouts/base.twig' %}

{% block title %}
	{{ entry.title }} - {{ siteName }}
{% endblock %}

{% block content %}
	<article class="mx-auto max-w-7xl px-4 py-8">
		{# Hero Image #}
		{% set heroImage = entry.heroImage.one() %}
		{% if heroImage %}
			<img src="{{ heroImage.url }}" alt="{{ heroImage.title }}" class="mb-8 h-auto w-full" />
		{% endif %}

		{# Title #}
		<h1>{{ entry.title }}</h1>

		{# Meta: Date + Links #}
		<div class="my-4 flex gap-4">
			{% if entry.publishDate %}
				<span>{{ entry.publishDate|date('F Y') }}</span>
			{% endif %}

			{% if entry.projectUrl %}
				<a href="{{ entry.projectUrl }}" target="_blank" rel="noopener">View Project →</a>
			{% endif %}

			{% if entry.githubUrl %}
				<a href="{{ entry.githubUrl }}" target="_blank" rel="noopener">GitHub →</a>
			{% endif %}
		</div>

		{# Tech Stack - Essential Only #}
		{% set essentialTech = entry.techStackItems.all()|filter(tech => tech.techItemCategory.value == 'essential') %}
		{% if essentialTech|length %}
			<ul class="my-4 flex flex-wrap gap-2">
				{% for tech in essentialTech %}
					<li class="bg-gray-100 px-2 py-1 text-sm">{{ tech.techItemName }}</li>
				{% endfor %}
			</ul>
		{% endif %}

		{% set contentSections = entry.contentSections.all() %}

		{% if contentSections|length %}
			{% for section in contentSections %}
				{# Check what TYPE of block this is #}
				{% switch section.type %}

				{# OVERVIEW BLOCK #}
				{% case 'overview' %}
				<section class="my-8">
					<h2>{{ section.sectionTitle }}</h2>

					<ul class="list-unstyled my-4">
						{% if section.role %}
							<li><strong>Role:</strong> {{ section.role }}</li>
						{% endif %}
						{% if section.context %}
							<li><strong>Context:</strong> {{ section.context }}</li>
						{% endif %}
					</ul>

					{% set essentialTech =
						entry.techStackItems.all()|filter(tech => tech.techItemCategory.value == 'essential')
					%}
					{% if essentialTech|length %}
						<ul class="my-4 flex flex-wrap gap-2">
							{% for tech in essentialTech %}
								<li class="bg-gray-100 px-2 py-1 text-sm">{{ tech.techItemName }}</li>
							{% endfor %}
						</ul>
					{% endif %}

					{% if section.introText %}
						<div class="prose">
							{{ section.introText }}
						</div>
					{% endif %}
				</section>

				{# TEXT SECTION BLOCK #}
				{% case 'textSection' %}
				<section class="my-8">
					<h2>{{ section.sectionTitle }}</h2>
					<div class="prose">
						{{ section.introText }}
					</div>
					{% if section.isCollapsible %}
						<details class="project__details">
							<summary>
								{% if section.summaryText %}
									{{ section.summaryText }}
								{% else %}
									Read more about {{ section.sectionTitle }}
								{% endif %}
							</summary>
							<div class="prose">
								{{ section.content }}
							</div>
						</details>
					{% endif %}
				</section>

				{# IMAGE SECTION BLOCK #}
				{% case 'imageSection' %}
				{% set image = section.image.one() %}
				{% if image %}
					<figure class="my-8">
						<img src="{{ image.url }}" alt="{{ section.altText }}" class="h-auto w-full" />
						{% if section.caption %}
							<figcaption class="mt-2 text-sm text-gray-600">
								{{ section.caption }}
							</figcaption>
						{% endif %}
					</figure>
				{% endif %}

				{% endswitch %}
			{% endfor %}
		{% endif %}

		{# Gallery #}
		{% set galleryItems = entry.gallery.all() %}
		{% if galleryItems|length %}
			<section class="mt-8 grid grid-cols-2 gap-4">
				{% for item in galleryItems %}
					{% set image = item.image.one() %}
					{% if image %}
						<figure>
							{% if item.hasModal %}
								{# Clickable image that opens modal #}
								{% set modalImg = item.modalImage.one() ?: image %}
								{% set modalCap = item.modalCaption ?: item.caption %}
								<button
									type="button"
									class="gallery__trigger cursor-pointer border-0 bg-transparent p-0"
									data-modal-image="{{ modalImg.url }}"
									data-modal-alt="{{ item.altText }}"
									{% if modalCap %}data-modal-caption="{{ modalCap }}"{% endif %}
									aria-label="Open larger view of {{ item.altText }}"
								>
									<img
										src="{{ image.url }}"
										alt="{{ item.altText }}"
										{% if item.cssClasses %}class="{{ item.cssClasses }}"{% endif %}
									/>
								</button>
							{% else %}
								{# Regular non-clickable image #}
								<img
									src="{{ image.url }}"
									alt="{{ item.altText }}"
									{% if item.cssClasses %}class="{{ item.cssClasses }}"{% endif %}
								/>
							{% endif %}
							{% if item.caption %}
								<figcaption class="mt-2 text-sm text-gray-600">{{ item.caption }}</figcaption>
							{% endif %}
						</figure>
					{% endif %}
				{% endfor %}
			</section>

			{# Modal markup - only if at least one item has modal enabled #}
			{% if galleryItems|filter(item => item.hasModal)|length %}
				<dialog id="gallery-modal" class="gallery__modal fixed inset-0 z-50 m-0 h-full w-full border-0 bg-black/90 p-0">
					<div class="flex h-full w-full items-center justify-center p-4">
						<div class="relative max-h-full max-w-7xl">
							{# Close button #}
							<button
								type="button"
								class="gallery__modal__close absolute right-4 top-4 z-10 rounded bg-white/10 px-4 py-2 text-white hover:bg-white/20"
								aria-label="Close modal"
							>
								✕ Close
							</button>

							{# Image container #}
							<img
								id="gallery-modal-image"
								src=""
								alt=""
								class="max-h-[90vh] w-auto"
							/>

							{# Caption (if exists) #}
							<p id="gallery-modal-caption" class="mt-4 text-center text-white"></p>
						</div>
					</div>
				</dialog>
			{% endif %}
		{% endif %}

		{# Back link #}
		<a href="{{ url('projects') }}" class="mt-8 inline-block">← Back to Projects</a>
	</article>
{% endblock %}
